on:
  push:
    branches: [ main ]

jobs:
  bump:
    runs-on: windows-latest
    name: Build and bump version
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Install .NET 8
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: 8

      - name: Restore dependencies
        run: dotnet restore

      - name: Build
        run: dotnet build

      - name: Bump major build version
        id: bump-major
        uses: vers-one/dotnet-project-version-updater@v1.7
        with:
          file: "Tabletop Soundbar.csproj"
          version: "^.0.0.0"
        if: contains(github.event.head_commit.message, '[RELEASE]')

      - name: Bump minor build version
        id: bump-minor
        uses: vers-one/dotnet-project-version-updater@v1.7
        with:
          file: "Tabletop Soundbar.csproj"
          version: "*.^.0.0"
        if: contains(github.event.head_commit.message, '[FEATURE]')

      - name: Bump bulid build version
        id: bump-bulid
        uses: vers-one/dotnet-project-version-updater@v1.7
        with:
          file: "Tabletop Soundbar.csproj"
          version: "*.*.^.0"
        if: contains(github.event.head_commit.message, '[FIX]')

      - name: Bump revision build version
        id: bump-revision
        uses: vers-one/dotnet-project-version-updater@v1.7
        with:
          file: "Tabletop Soundbar.csproj"
          version: "*.*.*.^"
        if: contains(github.event.head_commit.message, '[BUG]')

      - run: |
          git config user.name "KacperPastusiak"
          git config user.email "pastusiakkacper@gmail.com"
          git add "Tabletop Soundbar.csproj"
          git commit --amend --no-edit
          git push --force-with-lease
        if: contains(fromJSON('["[BUG]", "[FIX], "[FEATURE], "[RELEASE]"]'), github.event.head_commit.message)
